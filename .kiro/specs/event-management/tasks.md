# Implementation Plan

## Task Overview

イベント管理機能の実装タスク。データ層 → API層 → フロントエンド層の順で進行し、最後に統合・検証を行う。

---

## Tasks

- [x] 1. データ層の実装
- [x] 1.1 イベント管理スキーマを作成する
  - イベントシリーズ、イベント、開催日の3テーブルを定義する
  - 外部キー制約を設定する（シリーズ→RESTRICT、開催日→CASCADE）
  - インデックスとユニーク制約を追加する
  - スキーマをエクスポートに追加する
  - _Requirements: 1.5, 5.3_

- [x] 1.2 バリデーションスキーマを作成する
  - イベントシリーズの挿入・更新スキーマを定義する
  - イベントの挿入・更新スキーマを定義する
  - 開催日の挿入・更新スキーマを定義する（日付形式YYYY-MM-DD）
  - 文字数制限を適用する（名前200文字以内）
  - 型エクスポートを追加する
  - _Requirements: 7.1, 7.2, 7.3_

- [x] 2. イベントシリーズAPIの実装
- [x] 2.1 (P) イベントシリーズのCRUDエンドポイントを実装する
  - シリーズ一覧取得（検索対応）を実装する
  - シリーズ新規作成を実装する
  - シリーズ名の重複チェック（大文字小文字無視）を実装する
  - シリーズ削除を実装する（イベント紐付き時は409エラー）
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3. イベントAPIの実装
- [x] 3.1 イベントのCRUDエンドポイントを実装する
  - イベント一覧取得（ページネーション、シリーズフィルタ、検索）を実装する
  - イベント詳細取得（開催日含む）を実装する
  - イベント新規作成を実装する
  - イベント更新を実装する
  - イベント削除を実装する（開催日はCASCADE削除）
  - 同一シリーズ内の回次重複チェックを実装する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.4, 3.5, 4.3, 4.4, 5.2, 5.3, 5.5_

- [x] 3.2 開催日のCRUDエンドポイントを実装する
  - 開催日一覧取得を実装する
  - 開催日追加を実装する
  - 開催日更新を実装する
  - 開催日削除を実装する
  - 日番号と日付の重複チェックを実装する
  - _Requirements: 6.1, 6.2, 6.4, 6.5, 6.6_

- [x] 4. APIルーターの統合
- [x] 4.1 イベント管理ルーターを管理画面APIに登録する
  - イベントシリーズルーターを登録する
  - イベントルーターを登録する（開催日ルーター含む）
  - 管理者認証ミドルウェアが適用されていることを確認する
  - _Requirements: 3.4, 4.3, 5.2, 6.2, 6.6_

- [x] 5. フロントエンドAPIクライアントの実装
- [x] 5.1 (P) イベント管理のAPI型とクライアント関数を追加する
  - イベントシリーズ、イベント、開催日の型定義を追加する
  - イベントシリーズAPI関数を追加する
  - イベントAPI関数を追加する
  - 開催日API関数を追加する
  - _Requirements: 1.1, 2.1, 6.1_

- [x] 6. フロントエンドUIの実装
- [x] 6.1 イベント一覧ページを作成する
  - イベント一覧テーブルを実装する（名前、シリーズ名、回次、開催期間、会場）
  - ページネーションを実装する
  - 検索機能を実装する
  - シリーズフィルタを実装する
  - 削除機能を実装する（確認ダイアログ付き）
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 5.1, 5.4_

- [x] 6.2 イベント作成・編集ダイアログを実装する
  - イベントシリーズ選択（新規作成機能付き）を実装する
  - イベント情報入力フォームを実装する
  - 新規作成モードを実装する
  - 編集モード（既存情報プリフィル）を実装する
  - バリデーションエラー表示を実装する
  - 成功メッセージ表示を実装する
  - _Requirements: 3.1, 3.2, 3.3, 3.6, 4.1, 4.2, 4.5, 7.4, 7.5_

- [x] 6.3 開催日管理セクションを実装する
  - 開催日一覧表示（日番号順）を実装する
  - 開催日追加機能を実装する
  - 開催日編集機能を実装する
  - 開催日削除機能を実装する
  - 日番号・日付入力フォームを実装する
  - _Requirements: 6.1, 6.2, 6.3, 6.6, 6.7_

- [ ] 7. 統合テストとE2Eテスト
- [ ]* 7.1 統合テストを作成する
  - イベントシリーズCRUD APIのテストを作成する
  - イベントCRUD APIのテストを作成する
  - 開催日CRUD APIのテストを作成する
  - シリーズ削除時のRESTRICT制約テストを作成する
  - イベント削除時のCASCADE削除テストを作成する
  - _Requirements: 1.5, 5.3, 7.4_

---

## Requirements Coverage

| Requirement | Tasks |
|-------------|-------|
| 1.1, 1.2, 1.3, 1.4, 1.5 | 1.1, 2.1 |
| 2.1, 2.2, 2.3, 2.4, 2.5 | 3.1, 6.1 |
| 3.1, 3.2, 3.3, 3.4, 3.5, 3.6 | 3.1, 4.1, 6.2 |
| 4.1, 4.2, 4.3, 4.4, 4.5 | 3.1, 4.1, 6.2 |
| 5.1, 5.2, 5.3, 5.4, 5.5 | 1.1, 3.1, 4.1, 6.1 |
| 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7 | 3.2, 4.1, 6.3 |
| 7.1, 7.2, 7.3, 7.4, 7.5 | 1.2, 6.2 |

---

## Parallel Execution Notes

- **2.1 (P)**: イベントシリーズAPIはイベントAPIと独立して実装可能（データ層完了後）
- **5.1 (P)**: APIクライアントはAPI実装と並行して型定義から着手可能
- その他のタスクは依存関係により順次実行が必要
