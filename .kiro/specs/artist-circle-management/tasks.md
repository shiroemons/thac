# Implementation Plan

## Task 1: データベーススキーマとバリデーション

- [x] 1.1 アーティスト・サークル関連テーブルの定義
  - artists、artist_aliases、circles、circle_linksの4テーブルを定義
  - 頭文字の文字種（initial_script）をenum型として定義
  - Nanoid形式のプライマリキーと自動タイムスタンプを設定
  - 外部キー制約（alias_types、platformsへの参照、カスケード削除）を設定
  - 名前カラムの大文字小文字無視の一意性インデックスを作成
  - 検索・フィルタ用のインデックスを作成
  - _Requirements: 1, 2, 3, 4, 11_

- [x] 1.2 Zodバリデーションスキーマの作成
  - 各エンティティのinsert/update/selectスキーマを定義
  - 頭文字の条件付きバリデーション（文字種に応じた必須チェック）を実装
  - 日付フィールドのISO 8601形式チェックを実装
  - URLフィールドの形式チェックを実装
  - 型エクスポートを追加
  - _Requirements: 8_

- [x] 1.3 スキーマのエクスポートとマイグレーション
  - schema/index.tsに新テーブルとバリデーションスキーマのエクスポートを追加
  - マイグレーションを生成・実行してテーブルを作成
  - _Requirements: 1, 2, 3, 4_

## Task 2: アーティストAPIの実装

- [x] 2.1 (P) アーティストCRUDエンドポイントの作成
  - 一覧取得（ページネーション、検索、頭文字フィルタ対応）
  - 詳細取得
  - 新規作成（Zodバリデーション、一意性チェック）
  - 更新
  - 削除（関連別名義のカスケード削除）
  - admin-authミドルウェアによる認証保護
  - 適切なHTTPステータス（400/401/404/409）の返却
  - _Requirements: 1, 5, 10_

## Task 3: アーティスト別名義APIの実装

- [x] 3.1 (P) アーティスト別名義CRUDエンドポイントの作成
  - 一覧取得（ページネーション、検索、アーティストIDフィルタ対応）
  - 親アーティスト名の結合取得
  - 詳細取得
  - 新規作成（同一アーティスト内での一意性チェック）
  - 更新
  - 削除
  - admin-authミドルウェアによる認証保護
  - _Requirements: 2, 6, 10_

## Task 4: サークルAPIの実装

- [x] 4.1 (P) サークルCRUDエンドポイントの作成
  - 一覧取得（ページネーション、検索、頭文字フィルタ対応）
  - 詳細取得（関連リンク情報を含む）
  - 新規作成（Zodバリデーション、一意性チェック）
  - 更新
  - 削除（関連リンクのカスケード削除）
  - admin-authミドルウェアによる認証保護
  - _Requirements: 3, 7, 10_

- [x] 4.2 サークル外部リンクCRUDエンドポイントの作成
  - サークルに紐づくリンク一覧取得
  - プラットフォーム名の結合取得
  - リンク追加（同一サークル内でのURL一意性チェック）
  - リンク更新
  - リンク削除
  - プラットフォーム削除時の制約エラー対応
  - _Requirements: 4, 10_

- [x] 4.3 管理ルーターへの統合
  - 新しいAPIルーターをadmin/index.tsに登録
  - ルートパスの設定（/admin/artists、/admin/artist-aliases、/admin/circles）
  - _Requirements: 1, 2, 3, 4_

## Task 5: フロントエンドAPIクライアントの拡張

- [x] 5.1 型定義とAPIクライアント関数の追加
  - Artist、ArtistAlias、Circle、CircleLinkインターフェースを定義
  - InitialScript型を定義
  - artistsApi（list/get/create/update/delete）を実装
  - artistAliasesApi（list/get/create/update/delete）を実装
  - circlesApi（list/get/create/update/delete）を実装
  - circleLinksApi（サークルに紐づくリンク操作）を実装
  - _Requirements: 1, 2, 3, 4_

## Task 6: アーティスト管理画面の実装

- [x] 6.1 (P) アーティスト一覧画面の作成
  - DataTableによるアーティスト一覧表示
  - 検索バー（名前、日本語名、英語名、ソート用名の部分一致）
  - 頭文字の文字種によるフィルタ機能
  - ページネーション（1ページ20件）
  - 編集・削除ボタンの表示
  - 検索結果0件時のメッセージ表示
  - ローディングインジケーター
  - _Requirements: 5, 9, 11_

- [x] 6.2 アーティスト作成・編集フォームの実装
  - 新規作成ダイアログ
  - 編集ダイアログ
  - フォームフィールド（名前、日本語名、英語名、ソート用名、頭文字の文字種、頭文字、備考）
  - 頭文字の文字種に応じた頭文字フィールドの必須切り替え
  - クライアント側バリデーション
  - 成功・エラートースト通知
  - 削除確認ダイアログ
  - 操作後の一覧リフレッシュ
  - _Requirements: 1, 8, 9_

## Task 7: アーティスト別名義管理画面の実装

- [x] 7.1 (P) アーティスト別名義一覧画面の作成
  - DataTableによる別名義一覧表示
  - 親アーティスト名の表示
  - 検索バー（別名義名の部分一致）
  - アーティストIDによるフィルタ機能
  - ページネーション（1ページ20件）
  - 編集・削除ボタンの表示
  - 検索結果0件時のメッセージ表示
  - _Requirements: 6, 9, 11_

- [x] 7.2 アーティスト別名義作成・編集フォームの実装
  - 新規作成ダイアログ
  - 編集ダイアログ
  - アーティスト選択（セレクト）と「新規作成」ボタンの配置
  - 「新規作成」ボタンでアーティスト作成ダイアログを表示（ネストモーダル）
  - アーティスト作成完了後、新規アーティストを自動選択
  - フォームフィールド（別名義名、別名義種別、頭文字の文字種、頭文字、使用開始日、使用終了日）
  - 別名義種別のマスタデータ取得・表示
  - クライアント側バリデーション
  - 成功・エラートースト通知
  - _Requirements: 2, 8, 9_

## Task 8: サークル管理画面の実装

- [x] 8.1 (P) サークル一覧画面の作成
  - DataTableによるサークル一覧表示
  - 検索バー（名前、日本語名、英語名の部分一致）
  - 頭文字の文字種によるフィルタ機能
  - ページネーション（1ページ20件）
  - 編集・削除ボタンの表示
  - 検索結果0件時のメッセージ表示
  - _Requirements: 7, 9, 11_

- [x] 8.2 サークル作成・編集フォームの実装
  - 新規作成ダイアログ
  - 編集ダイアログ
  - フォームフィールド（名前、日本語名、英語名、頭文字の文字種、頭文字、備考）
  - クライアント側バリデーション
  - 成功・エラートースト通知
  - 削除確認ダイアログ
  - _Requirements: 3, 8, 9_

- [x] 8.3 サークル外部リンク管理機能の実装
  - サークル詳細画面内での外部リンク一覧表示
  - プラットフォーム名の表示
  - リンク追加フォーム（プラットフォーム選択、URL、プラットフォーム内ID、ハンドル、公式フラグ、代表フラグ）
  - プラットフォームのマスタデータ取得・表示
  - リンク編集・削除機能
  - クライアント側バリデーション
  - _Requirements: 4, 8, 9_

## Task 9: ナビゲーションと統合確認

- [x] 9.1 管理者サイドバーへのメニュー追加
  - アーティスト管理へのリンクを追加
  - アーティスト別名義管理へのリンクを追加
  - サークル管理へのリンクを追加
  - アイコンとラベルの設定
  - _Requirements: 9_

- [x] 9.2 統合動作確認
  - 全画面の遷移とルーティング確認
  - CRUD操作の動作確認
  - 認証状態での表示確認
  - エラーハンドリングの確認
  - 型チェックとLintの実行
  - _Requirements: 9, 10, 11_
