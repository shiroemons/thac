# Implementation Plan

## Task Summary

| Metric | Value |
|--------|-------|
| Major Tasks | 5 |
| Sub-Tasks | 12 |
| Requirements Coverage | 6/6 (100%) |
| Estimated Time | 1-3 hours per sub-task |

## Tasks

- [ ] 1. データ層の実装
- [ ] 1.1 (P) 公開リンク用ID生成関数を追加する
  - 公式作品リンク用のID生成関数を追加し、`wl_` プレフィックスを付与する
  - 公式楽曲リンク用のID生成関数を追加し、`sl_` プレフィックスを付与する
  - 既存のID生成関数オブジェクトに新規エントリを追加する
  - _Requirements: 3.5_

- [ ] 1.2 (P) 公式作品リンクテーブルを定義する
  - 公式作品への公開リンクを格納するテーブルスキーマを定義する
  - 作品ID、プラットフォームコード、URL、表示順序のカラムを含める
  - 作品テーブルへの外部キー制約（CASCADE削除）を設定する
  - プラットフォームマスタへの外部キー制約（RESTRICT削除）を設定する
  - 同一作品内でのURL重複防止のためのユニーク制約を追加する
  - 作品IDに対するインデックスを追加する
  - _Requirements: 3.1, 3.3, 3.4, 4.3_

- [ ] 1.3 (P) 公式楽曲リンクテーブルを定義する
  - 公式楽曲への公開リンクを格納するテーブルスキーマを定義する
  - 楽曲ID、プラットフォームコード、URL、表示順序のカラムを含める
  - 楽曲テーブルへの外部キー制約（CASCADE削除）を設定する
  - プラットフォームマスタへの外部キー制約（RESTRICT削除）を設定する
  - 同一楽曲内でのURL重複防止のためのユニーク制約を追加する
  - 楽曲IDに対するインデックスを追加する
  - _Requirements: 3.2, 3.3, 3.4, 4.3_

- [ ] 1.4 バリデーションスキーマを定義する
  - 公式作品リンクの作成・更新用バリデーションスキーマを定義する
  - 公式楽曲リンクの作成・更新用バリデーションスキーマを定義する
  - URL形式のバリデーションルールを追加する
  - 必須フィールドと任意フィールドを適切に設定する
  - 1.2, 1.3のテーブル定義完了後に実施
  - _Requirements: 3.5_

- [ ] 2. バックエンド層の実装（作品リンクAPI）
- [ ] 2.1 公式作品リンクの一覧取得・作成APIを実装する
  - 指定作品に紐づく公開リンク一覧を取得するエンドポイントを実装する
  - プラットフォーム名を含む結合クエリで取得する
  - 表示順序の昇順でソートして返却する
  - 新規リンクを作成するエンドポイントを実装する
  - URL重複時は409エラーを返却する
  - 管理者認証ミドルウェアを適用する
  - _Requirements: 1.2, 6.1, 6.3, 6.4_

- [ ] 2.2 公式作品リンクの更新・削除・並べ替えAPIを実装する
  - 既存リンクを更新するエンドポイントを実装する
  - リンクを削除するエンドポイントを実装する
  - リンクの表示順序を更新するエンドポイントを実装する
  - 存在しないリンクへのアクセスは404エラーを返却する
  - 管理者認証ミドルウェアを適用する
  - _Requirements: 1.4, 5.2, 6.1, 6.3, 6.4_

- [ ] 3. バックエンド層の実装（楽曲リンクAPI）
- [ ] 3.1 (P) 公式楽曲リンクの一覧取得・作成APIを実装する
  - 指定楽曲に紐づく公開リンク一覧を取得するエンドポイントを実装する
  - プラットフォーム名を含む結合クエリで取得する
  - 表示順序の昇順でソートして返却する
  - 新規リンクを作成するエンドポイントを実装する
  - URL重複時は409エラーを返却する
  - 管理者認証ミドルウェアを適用する
  - 2.1と並行して実装可能（ファイルが異なるため）
  - _Requirements: 2.2, 6.2, 6.3, 6.4_

- [ ] 3.2 (P) 公式楽曲リンクの更新・削除・並べ替えAPIを実装する
  - 既存リンクを更新するエンドポイントを実装する
  - リンクを削除するエンドポイントを実装する
  - リンクの表示順序を更新するエンドポイントを実装する
  - 存在しないリンクへのアクセスは404エラーを返却する
  - 管理者認証ミドルウェアを適用する
  - 2.2と並行して実装可能（ファイルが異なるため）
  - _Requirements: 2.4, 5.2, 6.2, 6.3, 6.4_

- [ ] 4. フロントエンド層の実装
- [ ] 4.1 リンク追加・編集ダイアログコンポーネントを作成する
  - プラットフォーム選択ドロップダウンを実装する
  - プラットフォームマスタから選択肢を取得して表示する
  - URL入力フィールドを実装する
  - 作成モードと編集モードを切り替え可能にする
  - 作品リンク・楽曲リンク両方で再利用可能な設計にする
  - バリデーションエラーメッセージを表示する
  - _Requirements: 1.1, 1.3, 2.1, 2.3, 4.2_

- [ ] 4.2 公式作品詳細画面にリンク管理カードを追加する
  - 公開リンク一覧カードを作品詳細ページに追加する
  - リンク一覧を表示順序の昇順で表示する
  - 各リンクにプラットフォーム名とURLを表示する
  - リンク追加ボタンを配置し、クリック時にダイアログを表示する
  - 各リンクに編集・削除ボタンを配置する
  - 順序変更ボタンを配置し、並べ替え機能を提供する
  - 4.1のダイアログコンポーネント完了後に実施
  - _Requirements: 1.1, 1.3, 1.4, 1.5, 5.1, 5.3_

- [ ] 4.3 公式楽曲詳細画面にリンク管理カードを追加する
  - 公開リンク一覧カードを楽曲詳細ページに追加する
  - リンク一覧を表示順序の昇順で表示する
  - 各リンクにプラットフォーム名とURLを表示する
  - リンク追加ボタンを配置し、クリック時にダイアログを表示する
  - 各リンクに編集・削除ボタンを配置する
  - 順序変更ボタンを配置し、並べ替え機能を提供する
  - 4.1のダイアログコンポーネント完了後に実施
  - _Requirements: 2.1, 2.3, 2.4, 2.5, 5.1, 5.3_

- [ ] 5. 統合とデータベースセットアップ
- [ ] 5.1 データベーススキーマをプッシュして動作確認する
  - スキーマ変更をデータベースにプッシュする
  - 作品リンクのCRUD操作が正常に動作することを確認する
  - 楽曲リンクのCRUD操作が正常に動作することを確認する
  - 認証なしアクセスで401エラーが返却されることを確認する
  - URL重複時に409エラーが返却されることを確認する
  - 順序変更機能が正常に動作することを確認する
  - _Requirements: 1.2, 1.4, 2.2, 2.4, 3.5, 6.4_

## Requirements Coverage Matrix

| Requirement | Task Coverage |
|-------------|---------------|
| 1.1 | 4.1, 4.2 |
| 1.2 | 2.1 |
| 1.3 | 4.1, 4.2 |
| 1.4 | 2.2, 4.2, 5.1 |
| 1.5 | 4.2 |
| 2.1 | 4.1, 4.3 |
| 2.2 | 3.1, 5.1 |
| 2.3 | 4.1, 4.3 |
| 2.4 | 3.2, 4.3, 5.1 |
| 2.5 | 4.3 |
| 3.1 | 1.2 |
| 3.2 | 1.3 |
| 3.3 | 1.2, 1.3 |
| 3.4 | 1.2, 1.3 |
| 3.5 | 1.1, 1.4, 5.1 |
| 4.1 | (既存platforms使用) |
| 4.2 | 4.1 |
| 4.3 | 1.2, 1.3 |
| 5.1 | 4.2, 4.3 |
| 5.2 | 2.2, 3.2 |
| 5.3 | 4.2, 4.3 |
| 6.1 | 2.1, 2.2 |
| 6.2 | 3.1, 3.2 |
| 6.3 | 2.1, 2.2, 3.1, 3.2 |
| 6.4 | 2.1, 2.2, 3.1, 3.2, 5.1 |
