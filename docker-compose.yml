services:
  server:
    image: oven/bun:1
    working_dir: /app
    command: sh -c "bun install && bun run --hot apps/server/src/index.ts"
    ports:
      - "3000:3000"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    environment:
      - DATABASE_URL=file:/app/packages/db/local.db
      - DATABASE_AUTH_TOKEN=
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET:-dev-secret-key-for-local-development}
      - BETTER_AUTH_URL=http://localhost:3000
      - CORS_ORIGIN=http://localhost:3001

  web:
    image: oven/bun:1
    working_dir: /app
    command: sh -c "bun install && cd apps/web && bunx vite dev --port=3001 --host"
    ports:
      - "3001:3001"
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    environment:
      - VITE_SERVER_URL=http://localhost:3000
    depends_on:
      - server

volumes:
  node_modules:
